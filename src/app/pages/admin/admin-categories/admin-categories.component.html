<section class="admin-page">
  <header class="admin-page__header">
    <div>
      <p class="admin-page__eyebrow">Структура каталога</p>
      <h2>Категории</h2>
      <p class="admin-page__subtitle">Группируйте товары, формируйте витрины и управляйте SEO-настройками.</p>
    </div>
    <button class="admin-button admin-button--primary admin-button--create" type="button" (click)="toggleCreateForm()">
      {{ showCreateForm ? 'Скрыть форму' : 'Новая категория' }}
    </button>
  </header>

  <article class="admin-card admin-card--form" *ngIf="showCreateForm">
    <div class="admin-card__header">
      <h3>Новая категория</h3>
      <span class="admin-pill">Черновик</span>
    </div>
    <form class="admin-form" (ngSubmit)="saveCategory()">
      <label>
        Название
        <input type="text" name="title" [(ngModel)]="form.title" />
      </label>
      <label>
        Описание
        <textarea rows="4" name="description" [(ngModel)]="form.description"></textarea>
      </label>
      <label>
        Highlight
        <input type="text" name="highlight" [(ngModel)]="form.highlight" />
      </label>

      <div class="admin-form__tags">
        <label>Теги</label>
        
        <div class="current-tags" *ngIf="form.tags.length > 0">
          <span class="tag-pill" *ngFor="let tag of form.tags">
            {{ tag }}
            <button type="button" class="remove-tag" (click)="removeTag(tag)">×</button>
          </span>
        </div>

        <div class="available-tags" *ngIf="availableTags.length > 0">
          <p class="small-label">Доступные теги:</p>
          <div class="tags-cloud">
            <button 
              type="button" 
              class="tag-chip" 
              *ngFor="let tag of availableTags" 
              [class.active]="form.tags.includes(tag)"
              (click)="toggleTag(tag)">
              {{ tag }}
            </button>
          </div>
        </div>
      </div>

      <div class="admin-form__actions">
        <button class="admin-button admin-button--primary" type="submit">Сохранить</button>
        <button class="admin-button" type="button" (click)="resetForm()">Сбросить</button>
      </div>
    </form>
  </article>

  <div class="admin-grid">
    <p class="admin-empty" *ngIf="isLoading">Загрузка категорий...</p>
    <ng-container *ngFor="let category of categories">
      <article class="admin-card">
        <div class="admin-card__header">
          <h3>{{ category.title }}</h3>
          <div class="tags-list">
             <span class="admin-pill" *ngFor="let tag of category.tags">{{ tag }}</span>
          </div>
        </div>
        <p class="admin-card__text">{{ category.description }}</p>
        <div class="admin-card__footer">
          <span class="admin-chip">{{ category.highlight }}</span>
          <div class="admin-actions">
            <button class="admin-button" type="button" (click)="selectCategory(category)">Редактировать</button>
            <button class="admin-button" type="button" (click)="deleteCategory(category)">Удалить</button>
          </div>
        </div>
      </article>

      <article class="admin-card admin-card--inline" *ngIf="selectedCategory?.id === category.id">
        <div class="admin-card__header">
          <h3>Редактирование категории</h3>
          <span class="admin-pill">ID {{ selectedCategory?.id }}</span>
        </div>
        <form class="admin-form" (ngSubmit)="saveCategory()">
          <label>
            Название
            <input type="text" name="editTitle" [(ngModel)]="form.title" />
          </label>
          <label>
            Описание
            <textarea rows="4" name="editDescription" [(ngModel)]="form.description"></textarea>
          </label>
          <label>
            Highlight
            <input type="text" name="editHighlight" [(ngModel)]="form.highlight" />
          </label>

          <div class="admin-form__tags">
            <label>Теги</label>
            
            <div class="current-tags" *ngIf="form.tags.length > 0">
              <span class="tag-pill" *ngFor="let tag of form.tags">
                {{ tag }}
                <button type="button" class="remove-tag" (click)="removeTag(tag)">×</button>
              </span>
            </div>
    
            <div class="available-tags" *ngIf="availableTags.length > 0">
              <p class="small-label">Доступные теги:</p>
              <div class="tags-cloud">
                <button 
                  type="button" 
                  class="tag-chip" 
                  *ngFor="let tag of availableTags" 
                  [class.active]="form.tags.includes(tag)"
                  (click)="toggleTag(tag)">
                  {{ tag }}
                </button>
              </div>
            </div>
          </div>

          <div class="admin-form__actions">
            <button class="admin-button admin-button--primary" type="submit">Сохранить</button>
            <button class="admin-button" type="button" (click)="resetForm()">Сбросить</button>
          </div>
        </form>
      </article>
    </ng-container>
  </div>
</section>
