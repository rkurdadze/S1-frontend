<section class="admin-page">
  <header class="admin-page__header">
    <div>
      <p class="admin-page__eyebrow">{{ 'admin.items.eyebrow' | translate }}</p>
      <h2>{{ 'admin.items.title' | translate }}</h2>
      <p class="admin-page__subtitle">{{ 'admin.items.subtitle' | translate }}</p>
    </div>
    <button class="admin-button admin-button--primary admin-button--create" type="button" (click)="toggleCreateForm()">
      {{ showCreateForm ? ('admin.items.hide_form' | translate) : ('admin.items.show_form' | translate) }}
    </button>
  </header>

  <div class="admin-grid">
    <section class="admin-card admin-card--editor" *ngIf="showCreateForm">
      <div class="admin-card__header">
        <h3>{{ 'admin.items.new_card' | translate }}</h3>
        <span class="admin-pill">{{ 'admin.items.creating' | translate }}</span>
      </div>
      <form class="admin-form" (ngSubmit)="onCreateItem()">
        <label>
          {{ 'admin.items.name' | translate }}
          <input type="text" name="createName" [(ngModel)]="createForm.name" />
        </label>
        <label>
          {{ 'admin.items.price' | translate }}
          <input type="number" name="createPrice" [(ngModel)]="createForm.price" />
        </label>
        <label>
          {{ 'admin.items.description' | translate }}
          <textarea rows="4" name="createDescription" [(ngModel)]="createForm.description"></textarea>
        </label>
        <label class="admin-checkbox">
          <input type="checkbox" name="createPublish" [(ngModel)]="createForm.publish" />
          {{ 'admin.items.publish_immediately' | translate }}
        </label>
        <div class="admin-form__actions">
          <button class="admin-button admin-button--primary" type="submit">{{ 'admin.items.create_item' | translate }}</button>
        </div>
      </form>
    </section>

    <section class="admin-card admin-card--list">
      <div class="admin-card__header">
        <h3>{{ 'admin.items.list_title' | translate }}</h3>
        <span class="admin-pill">{{ 'admin.items.in_database' | translate: { count: items.length } }}</span>
      </div>
      <p class="admin-empty" *ngIf="isLoading">{{ 'admin.items.loading' | translate }}</p>
      <p class="admin-empty" *ngIf="errorMessage">{{ errorMessage }}</p>
      <div class="admin-list" *ngIf="items.length; else emptyItems">
        <ng-container *ngFor="let item of items">
          <article
            class="admin-list__row"
            (click)="selectItem(item)"
            [class.is-active]="item.id === selectedItem?.id"
          >
            <div class="admin-list__main">
              <div>
                <h4>{{ item.name }}</h4>
                <p class="admin-list__meta">{{ 'admin.items.id' | translate }} {{ item.id }} â€¢ {{ (item.publish ? 'admin.items.published' : 'admin.items.draft') | translate }}</p>
                <div class="admin-list__tags" *ngIf="item.tags?.length">
                  <span class="admin-chip" *ngFor="let tag of item.tags">{{ tag }}</span>
                </div>
              </div>
              <div class="admin-list__previews">
                <div class="admin-preview" *ngFor="let preview of getColorPreviews(item)">
                  <span class="admin-preview__swatch" [style.background]="preview.color"></span>
                  <img *ngIf="preview.image" [src]="preview.image" [alt]="preview.color" />
                  <span *ngIf="!preview.image" class="admin-preview__placeholder">{{ 'admin.items.no_photo' | translate }}</span>
                </div>
              </div>
            </div>
            <div class="admin-list__stats">
              <span class="admin-chip">{{ (item.publish ? 'admin.items.in_sale' : 'admin.items.hidden') | translate }}</span>
              <span class="admin-list__price">{{ 'admin.items.colors_count' | translate: { count: item.colors.length || 0 } }}</span>
              <div class="admin-list__actions">
                <button class="admin-button admin-button--ghost" type="button" (click)="$event.stopPropagation(); selectItem(item)">
                  {{ 'admin.items.edit' | translate }}
                </button>
                <button class="admin-button admin-button--ghost" type="button" (click)="$event.stopPropagation(); onDeleteItem(item)">
                  {{ 'admin.items.delete' | translate }}
                </button>
              </div>
            </div>
          </article>

          <div class="admin-inline-panel" *ngIf="selectedItem?.id === item.id">
            <div class="admin-card__header">
              <h3>{{ 'admin.items.editing' | translate }}</h3>
              <span class="admin-pill">{{ 'admin.items.id' | translate }} {{ selectedItem?.id }}</span>
            </div>
            <form class="admin-form" (ngSubmit)="onUpdateItem()">
              <label>
                {{ 'admin.items.name' | translate }}
                <input type="text" name="editName" [(ngModel)]="editForm.name" />
              </label>
              <label>
                {{ 'admin.items.price' | translate }}
                <input type="number" name="editPrice" [(ngModel)]="editForm.price" />
              </label>
              <label>
                {{ 'admin.items.description' | translate }}
                <textarea rows="4" name="editDescription" [(ngModel)]="editForm.description"></textarea>
              </label>
              <label class="admin-checkbox">
                <input type="checkbox" name="editPublish" [(ngModel)]="editForm.publish" />
                {{ 'admin.items.published' | translate }}
              </label>
              <div class="admin-form__actions">
                <button class="admin-button admin-button--primary" type="submit">{{ 'admin.items.save_changes' | translate }}</button>
                <button class="admin-button" type="button" (click)="onDeleteItem()">{{ 'admin.items.delete' | translate }}</button>
              </div>
            </form>
            <div class="admin-tags admin-tags--selected" *ngIf="selectedItemTags.length">
              <span class="admin-chip" *ngFor="let tag of selectedItemTags">{{ tag }}</span>
            </div>
            <div class="admin-inventory-panel">
              <app-item-colors
                [colors]="selectedItem?.colors ?? []"
                [itemId]="selectedItemId"
                [isAdmin]="true"
                (selectedColorEmitter)="onColorSelected($event)"
              ></app-item-colors>
              <app-item-sizes
                [item]="selectedItem!"
                [forColor]="selectedColor"
                [isAdmin]="true"
              ></app-item-sizes>
            </div>
            <div class="admin-image-panel">
              <div class="admin-image-panel__header">
                <h4>{{ 'admin.items.color_images' | translate }}</h4>
                <label class="admin-button admin-button--ghost" *ngIf="selectedColor">
                  {{ 'admin.items.upload' | translate }}
                  <input type="file" multiple (change)="onImagesSelected($event)" />
                </label>
              </div>
              <p class="admin-empty" *ngIf="!selectedColor">{{ 'admin.items.select_color_hint' | translate }}</p>
              <p class="admin-empty" *ngIf="isPhotosLoading">{{ 'admin.items.loading_images' | translate }}</p>
              <p class="admin-empty" *ngIf="photoError">{{ photoError }}</p>
              <div class="admin-image-grid" *ngIf="selectedColor">
                <div class="admin-image-card" *ngFor="let image of getSelectedColorImages()">
                  <img [src]="image.url" [alt]="('admin.items.id' | translate) + ' ' + image.id" />
                  <button class="admin-button admin-button--ghost" type="button" (click)="deleteImage(image.id)">
                    {{ 'admin.items.delete_image' | translate }}
                  </button>
                </div>
              </div>
            </div>
          </div>
        </ng-container>
      </div>
      <ng-template #emptyItems>
        <p class="admin-empty">{{ 'admin.items.no_items' | translate }}</p>
      </ng-template>
    </section>

    <section class="admin-card admin-card--tags">
      <div class="admin-card__header">
        <h3>{{ 'admin.items.tags_title' | translate }}</h3>
        <span class="admin-pill">{{ 'admin.items.active_tags' | translate: { count: tags.length } }}</span>
      </div>
      <p class="admin-empty" *ngIf="isTagsLoading">{{ 'admin.items.loading_tags' | translate }}</p>
      <p class="admin-empty" *ngIf="tagError">{{ tagError }}</p>
      <div class="admin-tags">
        <button
          class="admin-tag"
          type="button"
          *ngFor="let tag of tags"
          [class.is-active]="isTagActive(tag)"
          (click)="toggleTag(tag)"
        >
          {{ tag }}
          <span class="admin-tag__close" (click)="$event.stopPropagation(); removeTag(tag)">Ã—</span>
        </button>
      </div>
      <div class="admin-tag-input">
        <input type="text" [(ngModel)]="tagInput" name="tagInput" [placeholder]="'admin.items.new_tag_placeholder' | translate" />
        <button class="admin-button admin-button--primary" type="button" (click)="addTag()">{{ 'admin.items.add_tag' | translate }}</button>
      </div>
    </section>
  </div>
</section>
